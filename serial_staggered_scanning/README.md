# SERIAL STAGGERED SCANNING.
接触过单片机的小伙伴一定知道矩阵键盘，通过行和列确定按下按钮的坐标。在不使用锁存器的条件下，该方法需要的 io 口较多且存在按键冲突。本小结讨论一种新型的方法。

## 串行交错扫描原理
```
                     [-]           [-]
                     [R]           [R]
                      |             |
                      |             |
 [IO.0] --------------|-------------|------+---------------------------+-------------
                      |             |      |                           |  ...
 [IO.1] --------------|------+------|------|-------------+-------------|-------------
                      |      |      |      |             |             |  ...
                      |      |      +------|-------------|------+------|-------------
                      |      |      |      |             |      |      |
 [IO.2] --------------|------|------+--/ --+             |      +--/ --+  ...
                      |      |             |             |             |
                      +------|-------------|------+------|-------------|-------------
                      |      |             |      |      |             |
 [IO.3] --------------+--/ --+             |      +--/ --+             |
                             |             |             |             |
                      +----*[P]     +----*[P]     +----*[P]     +----*[P] ...
                      |      |      |      |      |      |      |      |
               +------+      +------+      +------+      +------+      |
               |             |             |             |             |
 [IO.4] -------+-----[>]-----+-----[>]-----+-----[>]-----+-----[>]-----+-------------
                             |             |             |             |
                            [C]           [C]           [C]           [C] ...
                             |             |             |             |
                             +-------------+-------------+-------------+-------------
                             |
                            [-]

定义：
R 为电阻
C 为电容
P 为 PMOS 管（* 为控制端）
- 为 GND
> 为肖特基二极管
/ 为开关

[-]
[R] 指示下拉

IO.0 为 B 组清除端
IO.1 为 A 组清除端
IO.2 为 B 组扫描端
IO.3 为 A 组扫描端
IO.4 为复位端

描述：
- 1. 让 IO.4 处于高电平（示意电源正极），等待肖特基链下的电容充电完成
- 2. 让 IO.2 IO.3 处于输入态，IO.0 IO.1 处于浮空态
- 3. 让 IO.4 处于低电平，此时左端第一个 PMOS Pi 导通，其他 PMOS 处于截止态。
     如果左端第一个开关断开，则 IO.3 得到的是顶部电阻下拉的低电平，否则将读取由左端第一个电容 Ci 提供的高电平
- 4. 读取第一个按键的状态后将 IO.1 置为低电平以便将 C0 清零，低电平的 C0 会让第二个 PMOS P1 导通，
     此时让 IO.0 和 IO.1 / IO.2 和 IO.3 互换角色，从步骤 2 开始依次扫描下一个键。
     电容也会依次被清零，而 PMOS 会从左到右依次导通
- 5. 当所有键扫描完成后，回到步骤 1

补充：
- 该方式不会存在按下多个键值冲突的情况
- 该方式会消耗较多的电容和二极管，且二极管封装通常较大不易于集成。
- 此外 PMOS 比较冷门，在此只用作原理描述，后期考虑采用对偶结构的 NMOS 作为替代

```